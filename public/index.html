<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GameRun.ai Video Optimizer</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- Header -->
        <div class="bg-white rounded-lg shadow-xl p-8 mb-8">
            <div class="text-center">
               <h1 class="text-4xl font-bold text-gray-900 mb-2">
    üèÄ‚öæ GameRun Video Optimizer ‚öΩüèí
</h1>
                <p class="text-gray-600">
                    Zero-effort video optimization for VLM processing
                </p>
            </div>
        </div>

        <div class="grid lg:grid-cols-2 gap-8">
            <!-- Section 1: Download from URL -->
            <div class="bg-white rounded-lg shadow-xl p-8">
                <div class="flex items-center gap-3 mb-6">
                    <span class="text-3xl">üì•</span>
                    <h2 class="text-2xl font-bold text-gray-900">Download from URL</h2>
                </div>

                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Video URL (Hudl, YouTube, etc.)
                        </label>
                        <input
                            type="text"
                            id="videoUrl"
                            placeholder="https://youtube.com/watch?v=... or https://vcloud.hudl.com/..."
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                        />
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-3">
                            Quality Preset
                        </label>
                        <select id="downloadPreset" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
    <option value="balanced" selected>Balanced - Recommended (1080p@30fps, ~1.4GB)</option>
    <option value="efficient">Efficient (720p@30fps, ~800MB)</option>
    <option value="minimal">Minimal (720p@24fps, ~500MB)</option>
</select>
                    </div>

                    <button
                        id="downloadBtn"
                        class="w-full bg-indigo-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-indigo-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                    >
                        Download & Optimize
                    </button>

                    <div id="downloadProgress" class="hidden">
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                            <div class="flex items-center gap-3">
                                <div class="animate-spin rounded-full h-5 w-5 border-b-2 border-indigo-600"></div>
                                <span class="text-blue-800" id="downloadStatus">Processing...</span>
                            </div>
                        </div>
                    </div>

                    <div id="downloadResult" class="hidden"></div>
                </div>
            </div>

            <!-- Section 2: Compress Existing File -->
            <div class="bg-white rounded-lg shadow-xl p-8">
                <div class="flex items-center gap-3 mb-6">
                    <span class="text-3xl">üóúÔ∏è</span>
                    <h2 class="text-2xl font-bold text-gray-900">Compress Video File</h2>
                </div>

                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-3">
                            Quality Preset
                        </label>
                        <select id="compressPreset" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                            <option value="balanced" selected>Balanced - Recommended (~1.4GB)</option>
                            <option value="efficient">Efficient (~800MB)</option>
                            <option value="minimal">Minimal (~500MB)</option>
                        </select>
                    </div>

                    <!-- Drag & Drop Zone -->
                    <div
                        id="dropZone"
                        class="border-4 border-dashed border-gray-300 rounded-lg p-12 text-center cursor-pointer hover:border-purple-500 transition-colors"
                    >
                        <input type="file" id="fileInput" accept="video/*" class="hidden" />
                        <div id="dropZoneContent">
                            <span class="text-6xl mb-4 block">üìÅ</span>
                            <p class="text-lg font-semibold text-gray-700 mb-2">
                                Drag & Drop Video Here
                            </p>
                            <p class="text-sm text-gray-500">
                                or click to browse
                            </p>
                            <p class="text-xs text-gray-400 mt-2">
                                Max file size: 5GB
                            </p>
                        </div>
                        <div id="fileInfo" class="hidden">
                            <span class="text-4xl mb-2 block">üé¨</span>
                            <p class="font-semibold text-gray-700" id="fileName"></p>
                            <p class="text-sm text-gray-500" id="fileSize"></p>
                        </div>
                    </div>

                    <button
                        id="compressBtn"
                        class="w-full bg-purple-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-purple-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                        disabled
                    >
                        Compress Video
                    </button>

                    <div id="compressProgress" class="hidden">
                        <div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
                            <div class="flex items-center gap-3 mb-2">
                                <div class="animate-spin rounded-full h-5 w-5 border-b-2 border-purple-600"></div>
                                <span class="text-purple-800" id="compressStatus">Compressing...</span>
                            </div>
                            <div class="w-full bg-purple-200 rounded-full h-2 mt-2">
                                <div id="uploadProgress" class="bg-purple-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>

                    <div id="compressResult" class="hidden"></div>
                </div>
            </div>
        </div>

        <!-- Preset Comparison -->
        <div class="bg-white rounded-lg shadow-xl p-8 mt-8">
            <h3 class="text-xl font-bold text-gray-900 mb-4">Quality Preset Comparison</h3>
            <div class="overflow-x-auto">
                <table class="w-full text-sm">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-4 py-3 text-left font-semibold">Preset</th>
                            <th class="px-4 py-3 text-left font-semibold">Best For</th>
                            <th class="px-4 py-3 text-left font-semibold">Resolution</th>
                            <th class="px-4 py-3 text-left font-semibold">Max Size</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-200">
    <tr class="bg-indigo-50">
        <td class="px-4 py-3 font-medium text-indigo-700">Balanced ‚≠ê</td>
        <td class="px-4 py-3">General game analysis (recommended)</td>
        <td class="px-4 py-3">1080p @ 30fps</td>
        <td class="px-4 py-3">~1.4GB</td>
    </tr>
    <tr>
        <td class="px-4 py-3 font-medium text-blue-700">Efficient</td>
        <td class="px-4 py-3">Quick analysis, multiple games</td>
        <td class="px-4 py-3">720p @ 30fps</td>
        <td class="px-4 py-3">~800MB</td>
    </tr>
    <tr>
        <td class="px-4 py-3 font-medium text-green-700">Minimal</td>
        <td class="px-4 py-3">Fast uploads, mobile viewing</td>
        <td class="px-4 py-3">720p @ 24fps</td>
        <td class="px-4 py-3">~500MB</td>
    </tr>
</tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // IMPORTANT: Change this to your Railway URL when deployed
        const API_URL = window.location.origin;
        // Example when deployed: const API_URL = 'https://your-app.up.railway.app';

        let selectedFile = null;

        // Download from URL
        document.getElementById('downloadBtn').addEventListener('click', async () => {
            const url = document.getElementById('videoUrl').value.trim();
            const preset = document.getElementById('downloadPreset').value;

            if (!url) {
                alert('Please enter a video URL');
                return;
            }

            const btn = document.getElementById('downloadBtn');
            const progress = document.getElementById('downloadProgress');
            const result = document.getElementById('downloadResult');

            btn.disabled = true;
            progress.classList.remove('hidden');
            result.classList.add('hidden');

            try {
                document.getElementById('downloadStatus').textContent = 'Downloading and optimizing video...';
                
                const response = await fetch(`${API_URL}/api/download`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ url, preset })
                });

                const data = await response.json();

                if (data.success) {
                    progress.classList.add('hidden');
                    result.classList.remove('hidden');
                    result.innerHTML = `
                        <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                            <p class="text-green-800 font-semibold mb-3">‚úì Video optimized successfully!</p>
                            <a href="${API_URL}${data.downloadUrl}" 
                               class="inline-block w-full bg-green-600 text-white py-2 px-4 rounded-lg font-semibold hover:bg-green-700 transition-colors text-center"
                               download>
                                Download Video
                            </a>
                        </div>
                    `;
                } else {
                    throw new Error(data.error || 'Unknown error');
                }
            } catch (err) {
                progress.classList.add('hidden');
                result.classList.remove('hidden');
                result.innerHTML = `
                    <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                        <p class="text-red-800">‚ùå Error: ${err.message}</p>
                    </div>
                `;
            } finally {
                btn.disabled = false;
            }
        });

        // Drag & Drop functionality
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        const compressBtn = document.getElementById('compressBtn');

        dropZone.addEventListener('click', () => fileInput.click());

        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('border-purple-500', 'bg-purple-50');
        });

        dropZone.addEventListener('dragleave', () => {
            dropZone.classList.remove('border-purple-500', 'bg-purple-50');
        });

        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('border-purple-500', 'bg-purple-50');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFile(e.target.files[0]);
            }
        });

        function handleFile(file) {
            if (!file.type.startsWith('video/')) {
                alert('Please select a video file');
                return;
            }

            selectedFile = file;
            const sizeMB = (file.size / (1024 * 1024)).toFixed(2);

            document.getElementById('dropZoneContent').classList.add('hidden');
            document.getElementById('fileInfo').classList.remove('hidden');
            document.getElementById('fileName').textContent = file.name;
            document.getElementById('fileSize').textContent = `${sizeMB} MB`;
            compressBtn.disabled = false;
        }

        // Compress file
        // Compress file with async job processing
document.getElementById('compressBtn').addEventListener('click', async () => {
    if (!selectedFile) {
        alert('Please select a file first');
        return;
    }

    const preset = document.getElementById('compressPreset').value;
    const btn = document.getElementById('compressBtn');
    const progress = document.getElementById('compressProgress');
    const result = document.getElementById('compressResult');

    btn.disabled = true;
    progress.classList.remove('hidden');
    result.classList.add('hidden');

    try {
        const formData = new FormData();
        formData.append('video', selectedFile);
        formData.append('preset', preset);

        // Step 1: Upload file
        document.getElementById('compressStatus').textContent = 'Uploading...';
        
        const uploadResponse = await fetch(`${API_URL}/api/compress`, {
            method: 'POST',
            body: formData
        });

        const uploadData = await uploadResponse.json();

        if (!uploadData.success) {
            throw new Error(uploadData.error || 'Upload failed');
        }

        // Step 2: Poll for completion
        document.getElementById('compressStatus').textContent = 'Upload complete! Processing...';
        document.getElementById('uploadProgress').style.width = '100%';

        const jobId = uploadData.jobId;
        let attempts = 0;
        const maxAttempts = 120; // 10 minutes max

        const checkStatus = async () => {
            attempts++;
            
            try {
                const statusResponse = await fetch(`${API_URL}/api/status/${jobId}`);
                const statusData = await statusResponse.json();

                console.log('Status check:', statusData); // DEBUG

                if (statusData.status === 'complete') {
                    // Success!
                    progress.classList.add('hidden');
                    result.classList.remove('hidden');
                    result.innerHTML = `
                        <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                            <p class="text-green-800 font-semibold mb-2">‚úì Video compressed successfully!</p>
                            <div class="text-sm text-green-700 mb-3">
                                <p>Original: ${statusData.stats?.originalSize || 'N/A'}MB</p>
                                <p>Compressed: ${statusData.stats?.compressedSize || 'N/A'}MB</p>
                                <p>Saved: ${statusData.stats?.reduction || 'N/A'}%</p>
                            </div>
                            <a href="${API_URL}${statusData.downloadUrl}" 
                               class="inline-block w-full bg-green-600 text-white py-2 px-4 rounded-lg font-semibold hover:bg-green-700 transition-colors text-center"
                               download>
                                Download Compressed Video
                            </a>
                        </div>
                    `;
                    
                    // Reset for next upload
                    selectedFile = null;
                    document.getElementById('dropZoneContent').classList.remove('hidden');
                    document.getElementById('fileInfo').classList.add('hidden');
                    fileInput.value = '';
                    btn.disabled = false;
                    
                } else if (statusData.status === 'error') {
                    throw new Error(statusData.error || 'Compression failed');
                    
                } else if (attempts >= maxAttempts) {
                    throw new Error('Processing timeout - file may be too large');
                    
                } else {
                    // Still processing
                    const messages = [
                        'Compressing large video file...',
                        'This may take several minutes...',
                        'Still working on it...',
                        'Almost there...'
                    ];
                    document.getElementById('compressStatus').textContent = messages[Math.floor(attempts / 3) % messages.length];
                    setTimeout(checkStatus, 5000); // Check again in 5 seconds
                }
                
            } catch (err) {
                throw err;
            }
        };

        // Start polling after 2 seconds
        setTimeout(checkStatus, 2000);

    } catch (err) {
        progress.classList.add('hidden');
        result.classList.remove('hidden');
        result.innerHTML = `
            <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                <p class="text-red-800">‚ùå Error: ${err.message}</p>
            </div>
        `;
        btn.disabled = false;
    }
});
 </script>
</body>
</html>